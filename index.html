
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Pragmatic Geographer</title>
  <meta name="author" content="Ben Reilly">

  
  <meta name="description" content="Killing the Crunch Mode Antipattern If you want a “knowledge worker” to be as ineffective and produce the lowest level of quality possible, deprive &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://bwreilly.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Pragmatic Geographer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-42737911-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pragmatic Geographer</a></h1>
  
    <h2>SOFTWARE GEOGRAPHY ECONOMICS HISTORY</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:bwreilly.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/resume">Resume</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/14/crunch-mode-does-not-work/">Crunch Mode Does Not Work</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-14T21:48:00-07:00" pubdate data-updated="true">Apr 14<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><blockquote><p><a href="http://chadfowler.com/blog/2014/01/22/the-crunch-mode-antipattern/">Killing the Crunch Mode Antipattern</a></p>

<p>If you want a <a href="http://www.slideshare.net/leadandtransform/knowledge-worker-productivity">“knowledge worker”</a> to be as ineffective and produce the lowest level of quality possible, <a href="http://www.ncbi.nlm.nih.gov/books/NBK19958/">deprive them of their sleep</a> and hold them to an unrealistic deadline&hellip;.</p>

<p><a href="http://legacy.igda.org/why-crunch-modes-doesnt-work-six-lessons">It makes people lazy and less productive</a>. This may seem ironic, but when someone puts in heroic levels of effort, they start to place less value on each minute.</p></blockquote>

<p>The last crunch mode I experienced virtually none of the code could be salvaged. We did a reasonable review of the work and realized more than half would need to be significantly refactored.</p>

<p>It turns out that there has been some study around when a project should be rewritten vs. being subject to an extensive refactoring. It does depend, but generally the cut-off is about 20-25% &ndash; if you need to change more than that, you are likely better off just rewriting it (<a href="http://www.cs.umd.edu/~basili/publications/journals/J70.pdf">Thomas, Delis, Basili, 1997</a>).</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/01/access-vs-validity-in-pragmatic-http-apis/">Access vs. Validity in Pragmatic HTTP APIs</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-01T08:46:00-07:00" pubdate data-updated="true">Nov 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It is obviously important to define the difference between the access a current client has to a resource and all of the valid methods that any client could potentially have.</p>

<p>This is the difference between the capabilities of a particular client (<em>access</em>) vs. the capabilities of the server (<em>validity</em>). Missing just one has significant problems:</p>

<p><strong>Missing Access</strong>: Clients have to test every possible action to determine what they are actually allowed to do.</p>

<p><strong>Missing Validity</strong>: The client knows what they can do, but not what the server can do. Should they need to look around to find a mechanism to be granted permission to act as they need?</p>

<p>And indeed, there appears to be a perfectly good HTTP header that means to address at least one of these:</p>

<blockquote><p><a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">RFC2616</a></p>

<p>The Allow entity-header field lists the set of methods supported
by the resource identified by the Request-URI. The purpose of this
field is strictly to inform the recipient of valid methods
associated with the resource.</p></blockquote>

<p>That appears to cover validity. But is there some other standard means of defining permitted actions? Must a user try and fail with <code>HTTP 403 Forbidden</code> (rather than <code>HTTP 405 Method Not Allowed</code>)?</p>

<p>I&rsquo;ve come across three potential solutions.</p>

<ol>
<li><p>Pragmatism.</p>

<p> If there isn&rsquo;t any granting mechanism or such, just use the Allow header to capture access. Without having to make addition requests, a client immediately knows what actions it can take next.</p></li>
<li><p>The <code>OPTIONS</code> method</p>

<p> The what?</p>

<blockquote><p>The OPTIONS method&hellip;allows the client to determine the options and/or requirements associated with a resource, or the capabilities of a server, without implying a resource action or initiating a resource retrieval.</p></blockquote>

<p> <a href="http://zacstewart.com/2012/04/14/http-options-method.html">Seemingly few servers implement this method</a> and it is a damn shame, because it could largely eliminate verbose API documentation and vastly increase programability of a resource.</p>

<p> You could define not just the permitted methods for that specific client, but also better define how to interact with the resource and describe how to potentially be granted additional access rights.</p>

<p> Shout out to <a href="http://django-rest-framework.org/">Django Rest Framework</a> for including this <a href="http://restframework.herokuapp.com/">out-of-the-box</a>.</p></li>
<li><p>Add an additional header</p>

<p> Something like a <code>Permitted</code> header might make sense, but like all extra headers there are concerns &ndash; they are less easily discovered by clients, hostile intermediaries may drop them, or they might be superseded by modifications to the HTTP spec itself.</p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/08/28/benefits-of-failure/">Some Benefits of Failure - Gallipoli</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-28T07:56:00-07:00" pubdate data-updated="true">Aug 28<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="right" src="/images/success.png" width="380" height="520">
It is a common trope, in the software world and <a href="http://www.ted.com/talks/jk_rowling_the_fringe_benefits_of_failure.html">elsewhere</a>, that failure can breed success. This is evident at the micro scale &ndash; failing code/tests are an inevitable starting condition for working code and passing tests.</p>

<p>At the more macro scale, there is an <a href="http://thefailcon.com/">entire conference</a> on the theme of startup failure and lessons learned from that failure. While no one should glorify failure, you want this kind of culture &ndash; having some acceptance of failure reduces the social risk of starting a new venture.</p>

<p>Some acceptance of failure is not unheard of in the military world either. I actually chose my first screen name based on a major event on this theme.</p>

<h3>The Campaign</h3>

<p>If a bigger and more comprehensive failure increases learning experience, then the Gallipoli campaign of 1915 was a serious education for the Allies. For them, everything went wrong.</p>

<p>First the <a href="https://en.wikipedia.org/wiki/Gallipoli_Campaign">backstory</a>:</p>

<blockquote><p>The Gallipoli Campaign…took place on the Gallipoli peninsula (Gelibolu in modern Turkey) in the Ottoman Empire between 25 April 1915 and 9 January 1916, during World War I. […] an amphibious landing was undertaken on the Gallipoli peninsula, to capture the Ottoman capital of Constantinople (Istanbul). After eight months the land campaign also failed with many casualties on both sides, and the invasion force was withdrawn to Egypt.</p></blockquote>

<h3>The Many Problems Faced by the Anzacs</h3>

<ul>
<li><p>They faced a motivated, dynamic, and prepared opposition lead by the founding father of modern Turkey.[1]</p></li>
<li><p>Exceedingly poor inter-branch communication/cooperation. There was no unified command for the operation &ndash; the navy was commanded independently and failed to clear the Dardanelles straits.</p></li>
</ul>


<p><img class="right" src="/images/Dardanelles.png" width="320" height="480"></p>

<ul>
<li><p>Incompetent logistician work. Many ships were not combat loaded and needed to stop in Alexandria to be reorganized, delaying for a month.</p></li>
<li><p>Contemporary military technology heavily favored the defensive and tactics to mitigate massed defensive firepower were primitive</p></li>
<li><p>Poor training and preparation. Both forces acted with bravery and stoicism under incredible hardships, but both received limited training in the run-up to the battle.</p></li>
<li><p>&ldquo;…it took place in circumstances in which nearly everything was experimental: in the use of submarines and aircraft, in the trial of modern naval guns agains artillery on the shore…the use of radio…land mines&rdquo; (Alan Moorehead, <em>Gallipoli</em>)</p></li>
</ul>


<h3>The Failure</h3>

<p>Gallipoli was a fiasco. A <a href="http://en.wikipedia.org/wiki/Dardanelles_Commission">commission</a> was set up to examine the incident and</p>

<blockquote><p>…concluded that the expedition was poorly planned and executed and that difficulties had been underestimated, problems which were exacerbated by supply shortages and by personality clashes and procrastination at high levels.</p></blockquote>

<p>Much of the blame fell on this guy:</p>

<p><img src="/images/192px-Sir_Winston_S_Churchill.jpg"></p>

<p>Chief Lord of the Admiralty, Winston Churchill. He was demoted and resigned. But as it turns out he wasn&rsquo;t done with politics.</p>

<h3>The Lesson</h3>

<p><a href="https://en.wikipedia.org/wiki/Gallipoli_Campaign">Gallipoli</a> is textbook example of unsuccessful modern amphibious attacks.</p>

<blockquote><p> the campaign &ldquo;became a focal point for the study of amphibious warfare&rdquo; in the United Kingdom and United States because it involved &ldquo;all four types of amphibious operations: the raid, demonstration, assault and withdrawal&rdquo;.</p></blockquote>

<p>Unified command. Understanding of the terrain. The element of surprise. Rapid expansion from the beachhead. Overwhelming fire suppression. Proper logistical and training preparation. Lessons hard learned.</p>

<h3>The Triumph</h3>

<p>This information directly informed planners and the strategic thinking of Allied leaders when formulating the Normandy invasion. From <a href="http://www.bbc.co.uk/history/worldwars/wwtwo/gallipoli_dday_01.shtml">the BBC</a>:</p>

<blockquote><p>[The planners] had grasped the vital necessity for an adequate period of planning for all three services &ndash; the army, navy and air force.</p>

<p>Meanwhile the slaughter on the Gallipoli beaches had taught the planners the necessity of smothering the immediate beach areas with massed fire from rocket ships and mortars to neutralise German defensive positions.</p></blockquote>

<p><img src="/images/NormandySupply.jpg"></p>

<p>Churchill certainly never forgot Gallipoli. In the 1920s, he published <em>The World Crisis</em>, which went into great detail &ndash; step by step &ndash; into the political and strategic background of the campaign (Moorehead). And later he was instrumental in making the Normandy landings possible and successful.</p>

<p>[1] The commander of Ottoman forces was one Mustafa Kemal, now more commonly known as <a href="https://en.wikipedia.org/wiki/Mustafa_Kemal_Atat%C3%BCrk">Atatürk</a> or &ldquo;Father of Turks&rdquo; and went on to found the modern nation of Turkey. Reacting quickly to the Anzac landings, he launched a vicious counterattack which seized the high ground and essentially doomed the invasion.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/23/rest-and-file-uploads-slash-attachments/">REST and File Uploads/Attachments</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-23T12:50:00-07:00" pubdate data-updated="true">Jul 23<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Your web application will support uploading files. At first glance, this is an action and you might consider working with it as an RPC endpoint rather than REST. The <code>upload</code> could refer to a verb rather than a noun.</p>

<p>There isn&rsquo;t anything really wrong with this, but I would argue there are significant advantages with going with it as a noun (REST resource). Here are a few:</p>

<h4>Staging an upload to external datastore</h4>

<p>An upload may not be directly to you, and it might not be used by the requesting client &ndash; signed S3 forms, one-time URL endpoints, other protocols like Bittorrent, and other mechanisms that allow direct client uploads.</p>

<p>Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;upload_to_url&quot;</span><span class="o">:</span> <span class="s2">&quot;https://example.com/one/time/endpoint/hashhashhash&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;signed_token&quot;</span><span class="o">:</span> <span class="s2">&quot;blahblahblah&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;expires&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-07-12T19:10:19.491Z&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;etc&quot;</span><span class="o">:</span> <span class="s2">&quot;...&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Tracking/auditing &ndash; both internally and externally</h4>

<p>What if a user wants to see what uploads are currently in progress? All of the successful ones? The failures? Those are all also useful metrics internally as well.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;createuser&quot;</span><span class="o">:</span> <span class="s2">&quot;https://example.com/user/1234&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;modifieduser&quot;</span><span class="o">:</span> <span class="s2">&quot;https://example.com/user/1234&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;createdate&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-07-12T19:10:19.491Z&quot;</span><span class="p">,</span>
</span><span class='line'>    <span class="s2">&quot;modifieduser&quot;</span><span class="o">:</span> <span class="s2">&quot;2013-07-12T19:10:19.491Z&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Attaching additional resources as a means of post-upload action</h4>

<p>The file being uploaded is unlikely to exist in a vacuum. You will have related resources and possibly related <em>actions</em>. Consider, for instance, that you want to send alerts to some people when the upload is complete:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="s2">&quot;subscribers&quot;</span><span class="o">:</span> <span class="p">[</span>
</span><span class='line'>      <span class="s2">&quot;https://example.com/user/1234&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;https://example.com/user/288&quot;</span><span class="p">,</span>
</span><span class='line'>      <span class="s2">&quot;https://example.com/user/3&quot;</span>
</span><span class='line'>    <span class="p">],</span>
</span><span class='line'>    <span class="s2">&quot;etc&quot;</span><span class="o">:</span> <span class="s2">&quot;...&quot;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h4>Explicit vs. implicit</h4>

<p>Bottom line &ndash; your <code>upload</code> has state information. You are probably capturing it anyway in logs or other resources. If you have some subscribers as above, you want to make that information explicit, and in many cases, client controlled.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/21/testing-search-haystack-in-django/">Testing Search (Haystack) in Django</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-21T19:33:00-07:00" pubdate data-updated="true">Jul 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://docs.djangoproject.com/en/dev/topics/testing/overview/">Django&rsquo;s build-in testing framework</a> is extremely handy. As long as you use the ORM with a supported data store, a test database is used for the duration of the tests and is cleaned up in between unit tests. There is no need for elaborate mocking &ndash; something I had grown accustom to in .NET.</p>

<p>Here is a quick sample, edited for brevity:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>./manage.py <span class="nb">test </span>appname -v 2
</span><span class='line'>
</span><span class='line'>Creating <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">&#39;default&#39;</span> <span class="o">(</span><span class="s1">&#39;test_projectname&#39;</span><span class="o">)</span>…
</span><span class='line'>Syncing...
</span><span class='line'>Creating tables ...
</span><span class='line'>test_first <span class="o">(</span>projectname.test.SampleTestClass<span class="o">)</span> ... ok
</span><span class='line'>test_second <span class="o">(</span>projectname.test.SampleTestClass<span class="o">)</span> ... ok
</span><span class='line'>test_third <span class="o">(</span>projectname.test.SampleTestClass<span class="o">)</span> ... ok
</span><span class='line'>Ran 3 tests in 1.260s
</span><span class='line'>OK
</span><span class='line'>Destroying <span class="nb">test </span>database <span class="k">for </span><span class="nb">alias</span> <span class="s1">&#39;default&#39;</span> <span class="o">(</span><span class="s1">&#39;test_projectname&#39;</span><span class="o">)</span>…
</span></code></pre></td></tr></table></div></figure>


<p>But if you are using some external source of data, it is necessary to create a mock or some fake environment (as Django does).</p>

<p><a href="http://haystacksearch.org/">Haystack</a> is a handy library that abstracts out the details of various search engines. You get some powerful features build into something like <a href="http://www.elasticsearch.org/">Elasticsearch</a> &ndash; high availability, full text search, spelling correct, <em>more like this</em>, etc &ndash; in some functions and data structures familiar to Django using developers.</p>

<p>But if you are <a href="https://en.wikipedia.org/wiki/Integration_testing">integration testing</a>, and you should be &ndash; the tests are calling your views directly and your views are updating or retrieving data from an external search engine, you are going to potentially have a bad time. Stuff will be persisted between unit tests and your results will be likely be inconsistent.</p>

<p>The solution is pretty simple actually. Fire up a new index, override the settings such that the new index is the target for the Haystack calls for the duration of tests, and clear the index between tests.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">TEST_INDEX</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;haystack.backends.elasticsearch_backend.ElasticsearchSearchEngine&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;URL&#39;</span><span class="p">:</span> <span class="s">&#39;http://127.0.0.1:9200/&#39;</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
</span><span class='line'>        <span class="s">&#39;INDEX_NAME&#39;</span><span class="p">:</span> <span class="s">&#39;test_index&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nd">@override_settings</span><span class="p">(</span><span class="n">HAYSTACK_CONNECTIONS</span><span class="o">=</span><span class="n">TEST_INDEX</span><span class="p">)</span>
</span><span class='line'><span class="k">class</span> <span class="nc">BaseTestCase</span><span class="p">(</span><span class="n">TestCase</span><span class="p">):</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">haystack</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="s">&#39;default&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">super</span><span class="p">(</span><span class="n">BaseTestCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">call_command</span><span class="p">(</span><span class="s">&#39;clear_index&#39;</span><span class="p">,</span> <span class="n">interactive</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="https://gist.github.com/bwreilly/6050981">Gist</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/18/ai-slash-machine-learning-python-samples/">AI/Machine Learning Python Samples</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-18T18:54:00-07:00" pubdate data-updated="true">Apr 18<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><div class="posterous_autopost">
I have a <a href="https://github.com/bwreilly/ai-ml">new repository on github</a> that demonstrates a couple of basic machine learning and AI techniques, principally picked up from CS_373 and Stanford&rsquo;s Introduction to AI. It&rsquo;s all explained there, and I intend to add to it as I continue my eduction in the field.</p>

<p>Machine learning is something I rarely hear talked about in the spatial developer field. This is unfortunate, as machine learning can be an effecitive means of analyzing, managing, and generating spatial information.</p>

<p>Another cool thing is the documentation I put together for this. I used <a href="http://fitzgen.github.com/pycco/">pycco</a>, a very easy to use annotated code document generator (port of <a href="http://jashkenas.github.com/docco/">Docco</a>). Here is a <a href="http://bwreilly.github.com/ai-ml/docs/pfilter.html">particle filter</a>. Here is a <a href="http://bwreilly.github.com/ai-ml/docs/kalman.html">Kalman filter</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/02/07/spatial-correction-using-a-particle-filter/">Spatial Correction Using a Particle Filter</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-07T18:50:00-08:00" pubdate data-updated="true">Feb 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><div class="posterous_autopost">
<h2>
The Problem &ndash; old data, important data</h2>
Some of the most important spatial data is old. It was built up and maintained over decades by paper and early computer systems, and it represents power lines, roads, water pipes, and property lines. It would be good to know the precise location of this stuff.
The PLC power system was designed on in-house drawn lotlines. Today, the difference between those lotlines and the actual parcel locations is as much as 100ft, and in no consistent direction. What follows are attempts to correct the location of more than 20,000 structures without doing a significant portion by hand, using some techniques picked up in Stanford&rsquo;s Free AI class.
<h2>
The correct location is the &ldquo;Hidden&rdquo; bit</h2>
Education in some very advanced and useful algorithms are now within the grasp of anyone with an internet connection and a decade old computer. More than a hundred thousand participated in the recently completed Stanford AI course, including myself. One particular technique caught my eye:
<iframe float="center" frameborder="0" height="315" src="http://www.youtube.com/embed/H0G1yslM5rc?rel=0" width="560"></iframe>
The problem being solved above is one of location &ndash; that is the hidden variable that needs to be estimated in continuous space. Why couldn&rsquo;t I do something similar for static assets like poles and underground vaults? With enough control points I could then move everything else relative to them (inverse distance weighted rubbersheeting) and vastly improve the data.
<h2>
A Naive Approach</h2>
I wanted to start with the simplest possible implementation. I loaded the lotlines (old, hand-drawn), parcel polygons, and the poles into PostGIS. I then converted the lines and polygons to points, and decided to use the total sum distance as the mechanism for comparing candidate particles to the poles.
Again, very naive (and the data is too noisy for it to work), but it served a purpose &ndash; getting everything set up for my next iteration: comparing candidates based on tangent and distance as the robot sensors above undoubtebly do.
<div style="font-size: 10px;">
</div></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/01/27/tilemill-what-it-does-and-some-reasons-to-try-it/">TileMill - What It Does and Some Reasons to Try It</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-27T19:45:00-08:00" pubdate data-updated="true">Jan 27<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="posterous_autopost">
<p>
We were promised jetpacks, but I&#8217;ll take [Tilemill](http://mapbox.com/tilemill/) as a temporary replacement: </p>
<p>
</p>
<img alt="jetpacks" src="/images/jetpacks.jpg" height="447" width="500" />
<p>
</p>
<p>
<em>The MapBox/DevelopmentSeed team has created one of the the last pieces really needed for mainstream open source GIS to gain really massive appeal</em></p>
<p>
TileMill is used for making web maps - or more specifically - for generating tiles that make up the now-ubiquiteous slippy maps we see online.</p>
<p>
There are other desktop applications that do this, the most notable being ArcGIS Desktop. But Desktop was built for other things first: advanced analysis tools, some pretty powerful editing capabilities, and authoring paper maps.</p>
<p>
<em>TileMill does one thing and it does it well</em>. It costs nothing (compared to several thousand for some flavor of ArcMap), and outputs an open tile format that you can wire up to a webmap or iPad in less time than it takes to install ArcMap.</p>
<p>
And it is <em>smooth</em>. The user experience is the best I have had with a desktop application in a long while.</p>
<p>
It also has sane, plaintext css-like styling (MSS). This may sound like a no-brainer, but your options before this were basically some proprietary binary format from ESRI (not extensible, difficult to automate, limiting, vendor specific) or SLD, which is open source but widely regarded as something of a mess for other reasons.</p>
<p>
There is also the training issue. ArcMap is giant and powerful - and extremely complex. The market for &#8220;GIS Analysts&#8221; is still strong in a large part because of this complexity. Less experienced users will find TillMill easier to pick up and web designers (of which there is a large pool of talent) will find it very easy.</p>
<p>
It is out for every operating system of note. Go give it a try.</p>
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/02/27/introducting-belatedly-nx-spatial/">Introducting (Belatedly) Nx_spatial</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-27T20:00:00-08:00" pubdate data-updated="true">Feb 27<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>
It&#8217;s been more or less done a while, but here is finally a blog post about it.</p>


<p>
<a href="https://bitbucket.org/gallipoli/nx_spatial">nx_spatial</a> is a collection of addon functions for the <a href="http://networkx.lanl.gov/index.html">networkx</a> python graph library. What can you do with it?</p>


<ol>
<li>Load GIS formats into <a href="http://networkx.lanl.gov/reference/introduction.html">networkx graphs</a> (where you can do all sorts of <a href="http://networkx.lanl.gov/reference/index.html">crazy analytics</a> on them)</li>
<li>Perform upstream and downstream traces with stopping points.</li>
<li>Set sources and find/repair edges that don&#8217;t have the correct to/from nodes.</li>
</ol>


<p>
Example from the <a href="https://bitbucket.org/gallipoli/nx_spatial/wiki/Home">wiki</a>:</p>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">nx_spatial</span> <span class="kn">as</span> <span class="nn">ns</span>
</span><span class='line'><span class="n">net</span> <span class="o">=</span> <span class="n">ns</span><span class="o">.</span><span class="n">read_shp</span><span class="p">(</span><span class="s">&#39;/shapes/lines.shp&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">net</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span> <span class="p">[[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)],</span> <span class="p">[(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)],</span> <span class="p">[(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]]</span>
</span><span class='line'><span class="n">net</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span> <span class="p">[(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]</span>
</span><span class='line'><span class="n">source</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span class='line'><span class="n">ns</span><span class="o">.</span><span class="n">setdirection</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
</span><span class='line'><span class="n">net</span><span class="o">.</span><span class="n">edges</span><span class="p">()</span> <span class="p">[[(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)],</span> <span class="p">[(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)],</span> <span class="p">[(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="p">(</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)]]</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Available on <a href="http://pypi.python.org/pypi/nx_spatial/0.3dev">pypi</a> or <a href="https://bitbucket.org/gallipoli/nx_spatial/wiki/Home">bitbucket</a>. Eventually I want to integrate it with networkx trunk (loading shapefiles is already in 1.4).</p>


<p style="font-size: 10px;">
<a href="http://posterous.com/">Posted via email</a>  from <a href="http://pragmaticgeographer.posterous.com/introducing-belatedly-nxspatial">The Pragmatic Geographer</a> </p>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/11/html5-file-api-first-impressions/">HTML5 File API: First Impressions</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-11T19:53:00-07:00" pubdate data-updated="true">Aug 11<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Recently went to an HTML5 Hackathon at Google Kirkland. My group&rsquo;s project was an in-browser IDE Chrome extension that zipped up a user-provided series of HTML/CSS/JS files into a package that could be uploaded to the Chrome Store. <a href="https://plus.google.com/110816632848977818341/about">Issac Lewis</a> came up with the idea after trying to develop chrome extensions on his chromebook and finding it basically impossible to do. Storing the files was a perfect use case for the FileSystem API, but I spent most of my time beating my head against the wall to get it working. Here are some of the things I wish I knew going in.</p>

<h3>The FileSystem API is not LocalStorage.</h3>

<p>LocalStorage is a key-value store, the FileSystem API really is an entire virtual file system, sandboxed on a user&rsquo;s local file system. You write, read, and create files async. It&rsquo;s also only implemented currently in Chrome. The documentation says 9+, but I hit errors until I switched from Chromium 12 to Chrome 13.</p>

<h3>There&rsquo;s no limit to the storage, currently.</h3>

<p>Hell yeah, cache all your map data on the user&rsquo;s local file system without needing an explicit download or local client built for it. That&rsquo;s a big deal for conditions or places with little to no connectivity. Also a big deal for massive games with a ton of art assets. They go through some good use cases <a href="http://www.html5rocks.com/en/tutorials/file/filesystem/#toc-usecases">here</a>.</p>

<h3>Debugging is a pain.</h3>

<p>You will hit the dreaded SECURITY_ERR or QUOTA_EXCEEDED_ERR at some point, and it will be because debugging locally (file://) doesn&rsquo;t work well in my experience. The documentation suggests it&rsquo;s possible by opening Chrome with the <em>&mdash;unlimited-quota-for-files</em> and<em> &mdash;allow-file-access-from-files</em> flags, but my problems were only resolved when I started debugging as an extension rather than as a local file.
You also need to be careful about the flux the API is in. Throwing around BlobBuilder() and other pieces of the newer APIs can throw errors that can be difficult to track down. BlobBuilder didn&rsquo;t work for me, I needed window.WebKitBlobBuilder. That <em>webkit</em> prefixing shows up elsewhere as well (like window.webkitRequestFileSystem).</p>

<p>Feel no guilt in lifting gratuitously from the sample docs when starting out.
Async file access isn&rsquo;t really any wierder than any other browser async work, but there is some boilerplate code that is worth snapping up. Example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">//error handling </span>
</span><span class='line'><span class="kd">function</span> <span class="nx">errorHandler</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">case</span> <span class="nx">FileError</span><span class="p">.</span><span class="nx">QUOTA_EXCEEDED_ERR</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;QUOTA_EXCEEDED_ERR&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nx">FileError</span><span class="p">.</span><span class="nx">NOT_FOUND_ERR</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;NOT_FOUND_ERR&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nx">FileError</span><span class="p">.</span><span class="nx">SECURITY_ERR</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;SECURITY_ERR&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nx">FileError</span><span class="p">.</span><span class="nx">INVALID_MODIFICATION_ERR</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;INVALID_MODIFICATION_ERR&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">case</span> <span class="nx">FileError</span><span class="p">.</span><span class="nx">INVALID_STATE_ERR</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;INVALID_STATE_ERR&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>    <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">msg</span> <span class="o">=</span> <span class="s1">&#39;Unknown Error&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error: &#39;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//file system instantiation</span>
</span><span class='line'><span class="nb">window</span><span class="p">.</span><span class="nx">requestFileSystem</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">PERSISTENT</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span> <span class="cm">/*5MB*/</span><span class="p">,</span> <span class="nx">FSCreatedSuccess</span><span class="p">,</span> <span class="nx">errorHandler</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This kind of thing is okay starting out, but you&rsquo;ll want a lot more out of the error handling eventually. The message is fine, but the code tells you nothing about <em>where</em> the error occurred and in reference to what object or operation.</p>

<p>It&rsquo;s not CRUD, mostly.
Don&rsquo;t look for an explicit <em>create</em> method somewhere, the default is <em>get or create</em> via [filesystem_obj].[directory].get[Directory|File]. All reading, writing, and updating is probably going to live in a closure that starts with that first get.</p>

<h3>Don&rsquo;t rush.</h3>

<p>I made the mistake of looking at the limited time allocated and starting just throwing the example code in willy-nilly. This is not what you do with an unfamiliar and very new API. The typical help online is not there yet because it hasn&rsquo;t been used yet in a widespread way, throwing those error messages into google is not going to help you (unless that is how you got to this page, naturally). Start with the example code, sure, but I would carefully <a href="http://www.html5rocks.com/en/tutorials/file/filesystem">read the entirety of the short intro</a> before trying random things to get it to work.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/04/14/crunch-mode-does-not-work/">Crunch Mode Does Not Work</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/11/01/access-vs-validity-in-pragmatic-http-apis/">Access vs. Validity in Pragmatic HTTP APIs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/28/benefits-of-failure/">Some Benefits of Failure - Gallipoli</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/23/rest-and-file-uploads-slash-attachments/">REST and File Uploads/Attachments</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/21/testing-search-haystack-in-django/">Testing Search (Haystack) in Django</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Ben Reilly -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'pragmaticgeographer';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
